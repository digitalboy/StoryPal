# 生字与生字率

**1. 引言**

本文档旨在详细解释中文学习平台项目中的核心概念：**生字**和**生字率**，以确保团队成员在开发过程中对这些概念有清晰、统一的理解。由于生字率直接影响用户学习体验和故事生成质量，因此务必保证其计算的准确性。

**2. 核心定义**

在中文学习平台项目中，我们使用以下核心定义：

*   **字 (Character)**
    *   **定义**: 汉字是中文的基本书写单位，例如 "我"、"你"、"好"、"学"、"习" 等。
    *   **注意**:  **标点符号和非中文字符不属于字，在计算生字率时不应包含标点符号和非中文字符。**
*   **词 (Word)**
    *   **定义**:  词是由一个或多个汉字组成的具有完整语义的语言单位，例如 "你好"、"朋友"、"学习"、"火车站" 等。
    *    **注意**:  词由字组成，词的级别由字决定。
*   **字的词性 (Part of Speech of Character)**
    *   **定义**: 字在特定语境下的语法分类， 例如： 名词 (noun), 动词 (verb), 形容词 (adjective), 副词 (adverb) 等。
    *   **意义**: 字的词性标注有助于理解句子结构和字的具体含义。例如，在“白色”中，“白”是形容词，而在“白说”中，“白”是副词。
    *   **常用词性**: 常用的词性包括：
        *   `n`：名词 (noun),  表示人或事物的名称，如 "苹果", "学校", "老师"。
        *   `v`：动词 (verb),  表示动作或者状态，如 "跑", "吃", "是"。
        *   `adj`：形容词 (adjective),  表示事物的性质或者状态，如 "好", "坏", "大"。
        *   `adv`：副词 (adverb),  修饰动词，形容词或者其他副词，如 "很", "非常", "快"。
        *   `PR`：代词 (pronoun)， 代替名词或者名词性的短语, 例如 "你", "我", "他"。
        *   `t`:  时间词 (temporal noun), 表示时间, 例如: "今天"，"早上"。
    *   **注意**: **在不同词性下，即使是同一个字，我们也将其视为不同的“字-词性”组合**。例如，“白/adj” 和 “白/adv” 在计算生字率时会被视为不同的单位。

*   **超童级别 (Chaotong Level)**
    *   **定义**: 本项目中使用的自定义词汇等级，用于表示词汇的难度。 例如 1-100 的整数， 数字越小，难度越低。
    *   **注意**: 每个词汇都有一个对应的超童级别，例如，级别 1 的词汇比级别 10 的词汇更简单。
*   **已知字 (Known Character)**
    *   **定义**:  一个 “字-词性” 组合如果出现在目标级别**以下级别**的词汇中，则该 “字-词性” 组合为已知字。
    *   **核心要点**:
        *   **基于 “字-词性” 组合**: 已知字的判断基于 **字及其词性** 是否在目标级别**以下级别**的词汇中出现。
    *   **反向定义**:
        *   **不是已知字**: 如果一个 “字-词性” 组合不在目标级别**以下级别**的词汇中出现，则它不是已知字。
    *   **正确示例**:
        *  如果目标级别为 10， 并且 `words.json` 文件中存在 "喜欢" (级别:5,  "喜/v",  "欢/adj" ) 和 "跑步" (级别: 10,  "跑/v",  "步/n") 的词汇，那么，对于文本 "我喜欢跑步"，  “喜/v”，"欢/adj" 是已知字, "跑/v", "步/n" 不是已知字。
        *   如果目标级别为 10， 并且 `words.json` 文件中存在 "白色" (级别:10,  "白/adj",  "色/n") 和 "白说" (级别: 10, "白/adv", "说/v"),  那么对于文本 "白色，白说"， "白/adj", "色/n", "白/adv" ,"说/v" 都不是已知字。
*   **生字 (New Character)**
    *   **定义**: 在指定目标级别**及其以下级别**中，所有词汇不包含的 **字-词性** 组合，被认为是生字。
    *   **反向定义**:
        *   **不是生字**: 如果一个 **字-词性** 组合出现在目标级别**及其以下级别**的词汇中，则它不是生字。
        *   **如果一个字和字的词性组合不在 `words.json` 中，则一定是生字。**
    *   **正确示例**:
        *   如果目标级别为 10， 并且 `words.json` 文件中不存在 "游泳" 的词汇，那么对于文本 "我喜欢游泳"， “游/v”，"泳/v" 都是生字。
         *  如果目标级别为 10， 并且 `words.json` 文件中只存在 “白色” (级别：10, "白/adj", "色/n" )， 那么对于文本  "白色，白说"，  “白/adv”， “说/v” 字都是生字。 因为 `words.json` 中没有 “白/adv”  和 “说/v” 。
    *   **注意**:  **生字的判断会考虑字的词性 (part of speech)。**
*   **生字率 (New Character Rate)**
    *   **定义**: 指文本中生字的數量与文本中所有字的數量的比率。
    *   **关键点**:
        *   **生字数量**: 文本中生字的个数。**同一个字在不同词性 (part of speech) 下，视为不同的字**。 例如：“白/adj” 和  “白/adv”  是不同的字
        *   **总字数**: 文本中所有汉字的个数， **不包含标点符号和非中文字符**。  **同一个字在不同词性下，视为不同的字**。
    *   **计算公式**:
        *   `生字率 = 生字数量 / 总字数`
        *   `已知字率 = 已知字数 / 总字数`
        *   `生字率 = 1 - 已知字率`
    *   **注意**:
        *   生字率是一个相对的概念，它取决于目标级别。

**3. 生字率计算步骤**

   生字率的计算步骤如下：

1.  **文本预处理**
    *   **提取中文**: 使用正则表达式提取文本中的所有中文字符。**排除标点符号和非中文字符**。
2.  **已知词汇加载**
    *   加载 `words.json` 文件中的所有词汇，并根据目标级别过滤出已知词汇，使用 `_load_known_words` 函数, 并存储已知字。
         *  **`_load_known_words` 函数**: 加载**小于目标级别**的所有词汇，构建一个集合 (set), 包含所有已知**字和字的词性** 。
3.  **生字判断**
    *   遍历文本中的每一个汉字。
    *   如果该 **字和字的词性** 存在于已知字集合中，则该字是已知字。
    *   如果该 **字和字的词性** 不存在已知字集合中，则是生字。 **如果一个 字和字的词性 不在 `words.json` 中，则一定是生字。**
4.  **生字计数**: 统计文本中所有字的数量，以及已知字的个数。**同一个字在不同词性 (part of speech) 下，视为不同的字**。
5.  **生字率计算**: 使用以下公式计算生字率：
    *   `生字率 = 生字数量 / 总字数`
    *   `已知字率 = 已知字数 / 总字数`
    *   `生字率 = 1 - 已知字率`

**4. 重点总结 (Lessons Learned)**

*   **精确理解定义**: 务必清晰理解生字、已知字和生字率的定义，避免产生歧义。**当前版本的生字率计算只关注 字和字的词性 是否在已知词汇中出现。**
*   **已知字的定义：**  **已知字是指目标级别 *以下级别* 中出现的  字和字的词性，不包括目标级别的字。**
*    **`words.json` 的重要性**: **生字的判断依赖于 `words.json` 文件，如果一个 字和字的词性 不在 `words.json` 中，则一定是生字。**
*   **简化实现**:  在当前阶段，生字率的计算只需要关注  字和字的词性 本身。
*   **避免过度设计**:  在没有明确需求的情况下，不要过早地引入复杂的逻辑。
*   **测试驱动开发**: 编写测试用例能够帮助我们尽早发现代码中的错误和理解上的偏差。
*   **及时沟通**: 及时沟通和反馈可以帮助我们纠正理解上的偏差，确保对问题的看法一致。
*   **代码实现必须严格遵循定义**:  代码实现必须与文档中的定义保持一致。

**5. 未来方向**

*   未来，如果需要添加更高级的字词处理（例如：考虑词的词性，同义词等），我们需要修改 `_load_known_words`， `_is_known_char` 和 `calculate_literacy_rate` 函数，并且修改测试用例。

**6. 最佳实践**

*   **理解定义**: 务必理解生字、已知字和生字率的定义，避免产生歧义。
*   **`words.json` 的重要性**: **生字的判断依赖于 `words.json` 文件，如果一个 字和字的词性 不在 `words.json` 中，则一定是生字。**
*   **避免硬编码**:  不要在代码中硬编码任何级别值，应该从配置中读取。
*   **添加日志**: 在关键步骤添加日志，方便调试。
*   **异常处理**: 当 `words.json` 文件无法加载时，应该抛出异常并进行处理。
*   **边界情况**: 当 `words.json` 为空时，所有的汉字都应该被认为是生字。

**7. 总结**

本文档详细阐述了中文学习平台项目中的生字和生字率的概念。通过正确理解这些概念，并严格按照文档中的定义和计算步骤实现代码，我们可以确保生字率计算的准确性，从而为用户提供更好的学习体验.  **务必注意，生字率的计算依赖于 `words.json` 文件，如果一个 字和字的词性 不在 `words.json` 中，则一定是生字。**

