# 产品需求文档 (PRD)

## 1. 项目概述
### 1.1 项目背景
- 本项目是一个中文学习平台，旨在通过AI生成的故事帮助非中文母语的学习者提升中文水平。
- 项目由**蓝色冰川**（语言学习机构）发起，核心目标是根据用户中文水平生成适合的故事，并控制故事中的生字率和重点词汇。

### 1.2 项目目标
- 通过生成符合用户中文水平的故事，帮助用户更好地掌握词汇和语法。
- 提升用户在特定场景下的语言应用能力。
- 控制故事中的生字率，并确保重点词汇出现在故事中。

### 1.3 技术栈
- 后端：Python Flask
- AI服务：DeepSeek API
- 数据存储：词汇表、场景数据和生字表以JSON格式存储，支持查询和提示语生成。
- 部署环境：Docker

---

## 2. 目标用户
### 2.1 蓝色冰川（语言学习机构）
- 作为项目的直接用户，机构将通过API调用生成故事，提供给最终用户（中文学习者）。

### 2.2 最终用户
- 母语非中文的全球用户，中文水平从初级到高级不等。
- 用户希望通过故事学习中文，尤其是在特定场景（如问路、打车、点餐等）下的实用表达。
- 用户主要为准备通过HSK考试的学习者。

---

## 3. 项目功能模块
### 3.1 词汇管理模块
- **功能描述**：管理词汇表，支持词汇的添加、查询、更新和删除。
- **核心功能**：
  - 词汇分级：基于HSK等级并进一步细分为100个“超童级别”。
  - 词汇查询：根据级别、词性等条件查询词汇。
  - 词汇更新：支持动态更新词汇表。
- **数据格式**：词汇数据以JSON格式存储，包含级别、词性、拼音、释义、例句等信息。

### 3.2 场景管理模块
- **功能描述**：管理场景数据，支持场景的添加、查询、更新和删除。
- **核心功能**：
  - 场景分类：支持多种场景标签（如问路、打车、点餐）。
  - 场景查询：根据场景名称或描述查询场景。
  - 场景更新：支持动态更新场景数据。
- **数据格式**：场景数据以JSON格式存储，包含场景ID、名称、描述等信息。

### 3.3 生字管理模块
- **功能描述**：管理生字表，支持生字的添加、查询、更新和删除。
- **核心功能**：
  - 生字分级：基于HSK等级并进一步细分为100个“超童级别”。
  - 生字查询：根据级别、拼音等条件查询生字。
  - 生字更新：支持动态更新生字表。
- **数据格式**：生字数据以JSON格式存储，包含级别、拼音、释义、例句等信息。

### 3.4 提示语工程模块
- **功能描述**：根据用户需求生成提示语，用于指导AI生成故事。
- **核心功能**：
  - 提示语模板：提供多种提示语模板，支持动态配置。
  - 提示语生成：根据词汇级别、场景标签、篇幅、生字率、重点词汇等参数生成提示语。
- **数据格式**：提示语以文本格式存储，支持动态更新。

### 3.5 故事生成模块
- **功能描述**：通过DeepSeek API生成符合用户需求的故事。
- **核心功能**：
  - 故事生成：根据提示语生成故事，支持设置篇幅、生字率、重点词汇等参数。
  - 故事返回：生成的故事包含英文注释、生词列表、生字率和重点词汇，以JSON格式返回。
- **数据格式**：故事数据以JSON格式存储，包含故事ID、标题、内容、词汇级别、场景标签、生词列表、生字率、重点词汇等信息。

### 3.6 故事升级/降级模块
- **功能描述**：对现有故事进行升级或降级，调整词汇级别、生字率和重点词汇。
- **核心功能**：
  - 升级/降级逻辑：根据目标级别替换或添加词汇、生字和重点词汇。
  - 故事更新：返回更新后的故事，格式与故事生成API一致。
- **数据格式**：更新后的故事以JSON格式返回。

### 3.7 API接口模块
- **功能描述**：提供统一的API接口，支持故事生成、场景管理、词汇查询、生字管理等功能。
- **核心功能**：
  - 故事生成API：支持设置篇幅、生字率、场景、目标词汇级别、重点词汇等参数。
  - 场景管理API：支持场景的CRUD操作。
  - 词汇查询API：支持根据级别、词性等条件查询词汇。
  - 生字管理API：支持根据级别、拼音等条件查询生字。
  - 故事升级/降级API：支持根据目标级别更新故事。
- **数据格式**：API返回的数据均为JSON格式。

---

## 4. 功能需求
### 4.1 词汇分级与查询
- 词汇表包含100个级别，称为“超童级别”，基于HSK等级并进一步细分。
- 词汇表以JSON格式存储，每个词汇包含以下信息：
  - 级别（超童级别）
  - 词性（枚举类型，如：名词、动词、形容词、副词等）
  - 拼音
  - 释义
  - 例句
  - 创建时间
  - 更新时间
- 词汇JSON Schema示例：
  ```json
  {
    "word_id": "string", // 词汇唯一ID
    "word": "string", // 词汇
    "pinyin": "string", // 拼音
    "definition": "string", // 释义
    "part_of_speech": "string", // 词性（枚举：名词、动词、形容词、副词等）
    "level": "int", // 超童级别
    "example": "string", // 例句
    "created_at": "string", // 创建时间
    "updated_at": "string" // 更新时间
  }
  ```

### 4.2 场景管理
- 场景数据以JSON格式存储，支持CRUD操作（创建、读取、更新、删除）。
- 每个场景包含以下信息：
  - 场景ID
  - 场景名称（如：问路、打车、点餐）
  - 场景描述
  - 创建时间
  - 更新时间
- 场景JSON Schema示例：
  ```json
  {
    "scene_id": "string", // 场景唯一ID
    "name": "string", // 场景名称
    "description": "string", // 场景描述
    "created_at": "string", // 创建时间
    "updated_at": "string" // 更新时间
  }
  ```

### 4.3 生字管理
- 生字表以JSON格式存储，支持CRUD操作（创建、读取、更新、删除）。
- 每个生字包含以下信息：
  - 生字ID
  - 汉字
  - 拼音
  - 释义
  - 所属级别
  - 例句
  - 创建时间
  - 更新时间
- 生字JSON Schema示例：
  ```json
  {
    "character_id": "string", // 生字唯一ID
    "character": "string", // 汉字
    "pinyin": "string", // 拼音
    "definition": "string", // 释义
    "level": "int", // 所属级别
    "example": "string", // 例句
    "created_at": "string", // 创建时间
    "updated_at": "string" // 更新时间
  }
  ```

### 4.4 提示语工程
- 提供多种提示语模板，用于生成不同场景、生字率和重点词汇的故事。
- 提示语示例：
  - "请根据XX场景，设计一个小故事（或对话），字数为300（正负30字），生字率为0.01（正负0.005），重点词汇为：XXX、XXX、XXX。目的是让学习者掌握XXX级别的词汇（或XXX语法）。可选XXX词语为：（从JSON搜索出来的）"

### 4.5 故事生成
- 通过DeepSeek API生成故事，故事内容需符合用户指定的词汇级别、生字率、场景和重点词汇。
- 支持设置故事的篇幅（字数）、生字率、生字率容差和重点词汇。
- 生成的故事包含英文注释、生词列表、生字率和重点词汇。
- 故事生成API返回的JSON格式如下：
  ```json
  {
    "story_id": "string", // 故事唯一ID
    "title": "string", // 故事标题
    "content": "string", // 故事内容
    "vocabulary_level": "int", // 超童级别
    "scene": "string", // 场景标签（如：问路、打车、点餐）
    "word_count": "int", // 故事字数
    "new_words": [ // 生词列表
      {
        "word": "string", // 生词
        "pinyin": "string", // 拼音
        "definition": "string", // 释义
        "part_of_speech": "string", // 词性（枚举：名词、动词、形容词、副词等）
        "example": "string" // 例句
      }
    ],
    "new_char_rate": "float", // 实际生字率
    "key_words": [ // 重点词汇列表
      {
        "word": "string", // 重点词汇
        "pinyin": "string", // 拼音
        "definition": "string", // 释义
        "part_of_speech": "string", // 词性（枚举：名词、动词、形容词、副词等）
        "example": "string" // 例句
      }
    ],
    "created_at": "string" // 生成时间
  }
  ```

### 4.6 故事升级/降级
- 支持对现有故事进行升级或降级，根据目标级别替换或添加词汇、生字和重点词汇。
- 升级/降级逻辑：
  - 从当前级别（如5级）升级到目标级别（如6级），替换或添加更高级别的词汇、生字和重点词汇。
  - 从当前级别（如5级）降级到目标级别（如4级），替换或添加更低级别的词汇、生字和重点词汇。
- 升级/降级API参数：
  - **story_id**：需要升级/降级的故事ID。
  - **target_level**：目标级别（超童级别）。
- 升级/降级API返回更新后的故事，格式与故事生成API一致。

### 4.7 API接口
- 提供API接口，用户可以通过以下参数生成故事：
  - **篇幅**：故事的字数范围。
  - **篇幅容差**：故事字数的正负容差范围（如±30字）。
  - **生字率**：故事中生字的比例。
  - **生字率容差**：生字率的正负容差范围（如±0.005）。
  - **场景**：故事的场景标签（如：问路、打车、点餐）。
  - **目标词汇级别**：生词的超童级别。
  - **重点词汇**：目标级别中的个别词，确保出现在故事中。
- 提供场景管理、词汇管理和生字管理的API接口，支持相关数据的CRUD操作。
- 提供故事升级/降级的API接口，支持根据目标级别更新故事。
- API返回生成的故事、场景数据、词汇数据、生字数据或更新后的故事，格式为JSON。

---

## 5. 非功能需求
### 5.1 性能
- 故事生成API的响应时间应控制在1秒以内。
- 场景管理、词汇管理、生字管理API的响应时间应控制在500毫秒以内。
- 故事升级/降级API的响应时间应控制在1秒以内。

### 5.2 安全性
- API需进行身份验证，确保只有授权的语言学习机构可以调用。

### 5.3 可扩展性
- 词汇表、场景数据和生字表应支持动态更新，方便后续扩展。

---

## 6. 用户流程
1. **蓝色冰川**通过API调用，传入参数（篇幅、篇幅容差、生字率、生字率容差、场景、目标词汇级别、重点词汇）。
2. 后端根据参数查询词汇表、生字表和场景数据，生成提示语。
3. 调用DeepSeek API生成故事。
4. 返回生成的故事（JSON格式）给**蓝色冰川**。
5. **蓝色冰川**将故事提供给最终用户学习。
6. 用户或机构可以通过故事升级/降级API调整故事的词汇级别、生字率和重点词汇。

---

## 7. 优先级
### 高优先级
- 词汇分级与查询功能。
- 生字管理功能。
- 故事生成API的开发。
- 提示语工程的设计与实现。

### 中优先级
- 场景标签的设计与实现。
- 故事篇幅、生字率和重点词汇的设置功能。
- 故事升级/降级功能的开发。

### 低优先级
- 动态更新词汇表、场景数据和生字表的功能。

---

## 8. 时间线
- **第1周**：完成词汇表、生字表和场景数据的设计与JSON格式存储。
- **第2周**：开发词汇查询、生字查询和场景管理功能。
- **第3周**：设计提示语模板，集成DeepSeek API。
- **第4周**：开发故事生成API，支持场景标签、篇幅设置、生字率控制和重点词汇。
- **第5周**：开发故事升级/降级功能。
- **第6周**：测试与优化API性能。

---

## 9. 风险与假设
### 风险
- DeepSeek API的生成效果可能不符合预期，需进行多次调优。
- 词汇表、生字表和场景数据的级别划分可能不够准确，需根据用户反馈调整。

### 假设
- **蓝色冰川**会提供足够的词汇数据、生字数据和场景需求。
- DeepSeek API的调用成本在可接受范围内。

---

## 10. 数据模型设计
### 10.1 词汇表 JSON Schema
```json
{
  "word_id": "string", // 词汇唯一ID
  "word": "string", // 词汇
  "pinyin": "string", // 拼音
  "definition": "string", // 释义
  "part_of_speech": "string", // 词性（枚举：名词、动词、形容词、副词等）
  "level": "int", // 超童级别
  "example": "string", // 例句
  "created_at": "string", // 创建时间
  "updated_at": "string" // 更新时间
}
```

### 10.2 生字表 JSON Schema
```json
{
  "character_id": "string", // 生字唯一ID
  "character": "string", // 汉字
  "pinyin": "string", // 拼音
  "definition": "string", // 释义
  "level": "int", // 所属级别
  "example": "string", // 例句
  "created_at": "string", // 创建时间
  "updated_at": "string" // 更新时间
}
```

### 10.3 场景数据 JSON Schema
```json
{
  "scene_id": "string", // 场景唯一ID
  "name": "string", // 场景名称
  "description": "string", // 场景描述
  "created_at": "string", // 创建时间
  "updated_at": "string" // 更新时间
}
```

### 10.4 故事数据 JSON Schema
```json
{
  "story_id": "string", // 故事唯一ID
  "title": "string", // 故事标题
  "content": "string", // 故事内容
  "vocabulary_level": "int", // 超童级别
  "scene": "string", // 场景标签（如：问路、打车、点餐）
  "word_count": "int", // 故事字数
  "new_words": [ // 生词列表
    {
      "word": "string", // 生词
      "pinyin": "string", // 拼音
      "definition": "string", // 释义
      "part_of_speech": "string", // 词性（枚举：名词、动词、形容词、副词等）
      "example": "string" // 例句
    }
  ],
  "new_char_rate": "float", // 实际生字率
  "key_words": [ // 重点词汇列表
    {
      "word": "string", // 重点词汇
      "pinyin": "string", // 拼音
      "definition": "string", // 释义
      "part_of_speech": "string", // 词性（枚举：名词、动词、形容词、副词等）
      "example": "string" // 例句
    }
  ],
  "created_at": "string" // 生成时间
}
```

