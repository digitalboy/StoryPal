# 中文学习平台

## 1. 项目概述

### 1.1 项目背景

本项目是一个中文学习平台，旨在通过 AI 生成的故事帮助非中文母语的学习者提升中文水平。
项目由**蓝色冰川**（语言学习机构）发起，核心目标是根据用户中文水平生成适合的故事，并控制故事中的生字率和重点词汇。

### 1.2 项目目标

- 通过生成符合用户中文水平的故事，帮助用户更好地掌握词语和语法。
- 提升用户在特定场景下的语言应用能力。
- 控制故事中的生字率，并确保重点词汇出现在故事中。

### 1.3 技术栈

- 后端：Python Flask 3.1.0
- AI 服务：DeepSeek API (详细交互方式见 `docs/api.md`)
- 分词工具: 使用自定义分词，基于 `words.json` 进行分词。
- 数据存储：词语表、场景数据以 JSON 格式存储，未来可能会考虑使用数据库。
- API 文档: 使用 `Flask-RESTx` 自动生成 OpenAPI 文档。
- 部署环境：Docker

## 2. 目标用户

### 2.1 蓝色冰川（语言学习机构）

作为项目的直接用户，机构将通过 API 调用生成故事，提供给最终用户（中文学习者）。

### 2.2 最终用户

- 母语非中文的全球用户，中文水平从初级到高级不等。
- 用户希望通过故事学习中文，尤其是在特定场景（如问路、打车、点餐等）下的实用表达。
- 用户主要为准备通过 HSK 考试的学习者。

## 3. 项目功能模块

### 3.1 词语管理模块

- **功能描述**：管理词语表，支持词语的添加、查询、更新和删除。
- **核心功能**：
  - 词语分级：基于 HSK 等级并进一步细分为 100 个“超童级别”。
  - 词语查询：根据级别、词性等条件查询词语。
  - 词语更新：支持动态更新词语表。
- **数据格式**：词语数据以 JSON 格式存储，详细格式见 `docs/data_models.md`。
- **数据初始化**： 通过自动化的脚本导入 CSV 文件。

### 3.2 场景管理模块

- **功能描述**：管理场景数据，支持场景的添加、查询、更新和删除。
- **核心功能**：
  - 场景分类：支持多种场景标签（如问路、打车、点餐）。
  - 场景查询：根据场景名称或描述查询场景。
  - 场景更新：支持动态更新场景数据。
- **数据格式**：场景数据以 JSON 格式存储，详细格式见 `docs/data_models.md`。

### 3.3 提示语工程模块

- **功能描述**：根据用户需求生成提示语，用于指导 AI 生成故事。
- **核心功能**：
  - 提示语模板：提供多种提示语模板，使用 Jinja2 模板引擎动态配置。
  - 提示语生成：根据词语级别、场景标签、篇幅、生字率、重点词汇等参数生成提示语，支持多轮对话。
  - **多轮对话**: 使用状态机管理对话流程，根据用户的反馈动态调整对话策略。
- **数据格式**：提示语以文本格式存储，支持动态更新。

### 3.4 故事生成模块

- **功能描述**：通过 DeepSeek API 生成符合用户需求的故事。
- **核心功能**：
  - 故事生成：根据提示语生成故事，支持设置篇幅、生字率、重点词汇等参数。
  * 支持多轮对话。
  - 故事返回： 生成的故事包含 `story_id`。
- **数据格式**：故事数据以 JSON 格式存储，详细格式见 `docs/data_models.md`。

### 3.5 故事升级/降级模块

- **功能描述**：对现有故事进行升级或降级，调整词汇级别、生字率和重点词汇。
- **核心功能**：
  - 升级/降级逻辑：根据目标级别替换或添加词汇、生字和重点词汇。（详细逻辑后续补充）
  - 故事更新：返回更新后的故事，格式与故事生成 API 一致。
- **数据格式**：更新后的故事以 JSON 格式返回。

### 3.6 API 接口模块

- **功能描述**：提供统一的 API 接口，支持故事生成、场景管理、词语查询等功能。
- **核心功能**：
  - 故事生成 API：支持设置篇幅、生字率、场景、目标词汇级别、重点词汇等参数。
  - 场景管理 API：支持场景的 CRUD 操作。
  - 词语查询 API：支持根据级别、词性等条件查询词语。
  - 故事升级/降级 API：支持根据目标级别更新故事。
- **API 文档**: 详细 API 文档见 `docs/api.md`， 使用 `Flask-RESTx` 自动生成 OpenAPI 文档。
- **数据格式**：API 返回的数据均为 JSON 格式。

## 4. 用户流程

1.  **蓝色冰川**通过 API 调用，传入参数（目标故事的级别、生字率、故事场景、重要词汇、篇幅）。
2.  后端根据参数查询词语表和场景数据，生成提示语，支持多轮对话。
3.  调用 DeepSeek API 生成故事。
4.  返回生成的故事（JSON 格式）给**蓝色冰川**， 返回的 JSON 应该包含 `story_id`。
5.  **蓝色冰川**将故事提供给最终用户学习。
6.  用户或机构可以通过故事升级/降级 API 调整故事的词汇级别、生字率和重点词汇。

## 5. 优先级

### 高优先级

- 词语分级与查询功能。
- 故事生成 API 的开发。
- 提示语工程的设计与实现。

### 中优先级

- 场景标签的设计与实现。
- 故事篇幅、生字率和重点词汇的设置功能。
- 故事升级/降级功能的开发。

### 低优先级

- 动态更新词语表和场景数据的功能。

## 6. 时间线

- **第 1 周**：完成词语表和场景数据的设计与 JSON 格式存储。
- **第 2 周**：开发词语查询和场景管理功能。
- **第 3 周**：设计提示语模板，集成 DeepSeek API。
- **第 4 周**：开发故事生成 API，支持场景标签、篇幅设置、生字率控制和重点词汇, 支持多轮对话。
- **第 5 周**：开发故事升级/降级功能。
- **第 6 周**：测试与优化 API 性能。

## 7. 风险与假设

### 风险

- DeepSeek API 的生成效果可能不符合预期，需进行多次调优。
- 词语表和场景数据的级别划分可能不够准确，需根据用户反馈调整。

### 假设

- **蓝色冰川**会提供足够的词语数据和场景需求。
- DeepSeek API 的调用成本在可接受范围内。

## 8. 联系方式

如有任何问题，请联系：[your_email@example.com](mailto:your_email@example.com)

## 9. 其他

- **日期时间格式**: 所有日期时间格式都使用 ISO 8601 (例如：`2025-01-10T04:47:20Z`)。
- **UUID 生成**: 使用 Python 内置的 `uuid` 库生成 UUID。
- **API 鉴权**: 所有 API 需通过 API Key 进行身份验证，具体请参考 `docs/api.md`。
- **生字率的计算**: 生字率 = 生字数量 / 故事总字数, **同一个字在不同词性下视为不同词汇**。
  - **使用自定义分词逻辑，基于 `words.json` 文件进行分词。**
- **重点词汇**: 用户通过 API 参数 `key_word_ids` 指定， 在生成故事时重点词汇必须出现在生成的故事中。
- **数据验证**: 使用 JSON Schema 进行验证, 详细数据模型见 `docs/data_models.md`
