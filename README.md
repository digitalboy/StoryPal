# 产品需求文档 (PRD)

## 1. 项目概述
### 1.1 项目背景
- 这是一个中文学习项目，旨在帮助母语非中文的全球用户通过AI生成的故事来学习中文。
- 项目由**蓝色冰川**（语言学习机构）发起，作为其大项目的一部分，当前项目的核心目标是生成符合用户中文水平的故事。
- **蓝色冰川**的具体需求是根据词汇表和中文词汇的级别生成带有场景的故事，以提升用户体验。

### 1.2 项目目标
- 通过生成符合用户中文水平的故事，帮助用户更好地掌握词汇和语法。
- 提升用户在特定场景下的语言应用能力。

### 1.3 技术栈
- 后端：Python Flask
- AI服务：Deepseek API
- 数据存储：词汇表和场景数据以JSON格式存储，支持查询和提示语生成。
- 部署环境：Docker

---

## 2. 目标用户
### 2.1 蓝色冰川（语言学习机构）
- 作为项目的直接用户，机构将通过API调用生成故事，提供给最终用户（中文学习者）。

### 2.2 最终用户
- 母语非中文的全球用户，中文水平从初级到高级不等。
- 用户希望通过故事学习中文，尤其是在特定场景（如问路、打车、点餐等）下的实用表达。
- 用户主要为准备通过HSK考试的学习者。

---

## 3. 项目功能模块
### 3.1 词汇管理模块
- **功能描述**：管理词汇表，支持词汇的添加、查询、更新和删除。
- **核心功能**：
  - 词汇分级：基于HSK等级并进一步细分为100个“超童级别”。
  - 词汇查询：根据级别、词性等条件查询词汇。
  - 词汇更新：支持动态更新词汇表。
- **数据格式**：词汇数据以JSON格式存储，包含级别、词性、拼音、释义、例句等信息。

### 3.2 场景管理模块
- **功能描述**：管理场景数据，支持场景的添加、查询、更新和删除。
- **核心功能**：
  - 场景分类：支持多种场景标签（如问路、打车、点餐）。
  - 场景查询：根据场景名称或描述查询场景。
  - 场景更新：支持动态更新场景数据。
- **数据格式**：场景数据以JSON格式存储，包含场景ID、名称、描述等信息。

### 3.3 提示语工程模块
- **功能描述**：根据用户需求生成提示语，用于指导AI生成故事。
- **核心功能**：
  - 提示语模板：提供多种提示语模板，支持动态配置。
  - 提示语生成：根据词汇级别、场景标签、篇幅等参数生成提示语。
- **数据格式**：提示语以文本格式存储，支持动态更新。

### 3.4 故事生成模块
- **功能描述**：通过Deepseek API生成符合用户需求的故事。
- **核心功能**：
  - 故事生成：根据提示语生成故事，支持设置篇幅和篇幅容差。
  - 故事返回：生成的故事包含英文注释和生词列表，以JSON格式返回。
- **数据格式**：故事数据以JSON格式存储，包含故事ID、标题、内容、词汇级别、场景标签、生词列表等信息。

### 3.5 故事升级/降级模块
- **功能描述**：对现有故事进行升级或降级，调整词汇级别。
- **核心功能**：
  - 升级/降级逻辑：根据目标级别替换或添加词汇。
  - 故事更新：返回更新后的故事，格式与故事生成API一致。
- **数据格式**：更新后的故事以JSON格式返回。

### 3.6 API接口模块
- **功能描述**：提供统一的API接口，支持故事生成、场景管理、词汇查询等功能。
- **核心功能**：
  - 故事生成API：支持设置篇幅、篇幅容差、场景、目标词汇级别等参数。
  - 场景管理API：支持场景的CRUD操作。
  - 词汇查询API：支持根据级别、词性等条件查询词汇。
  - 故事升级/降级API：支持根据目标级别更新故事。
- **数据格式**：API返回的数据均为JSON格式。

---

## 4. 功能需求
### 4.1 词汇分级与查询
- 词汇表包含100个级别，称为“超童级别”，基于HSK等级并进一步细分。
- 词汇表以JSON格式存储，每个词汇包含以下信息：
  - 级别（超童级别）
  - 词性（枚举类型，如：名词、动词、形容词、副词等）
  - 拼音
  - 释义
  - 例句
  - 创建时间
  - 更新时间
- 词汇JSON Schema示例：
  ```json
  {
    "word_id": "string", // 词汇唯一ID
    "word": "string", // 词汇
    "pinyin": "string", // 拼音
    "definition": "string", // 释义
    "part_of_speech": "string", // 词性（枚举：名词、动词、形容词、副词等）
    "level": "int", // 超童级别
    "example": "string", // 例句
    "created_at": "string", // 创建时间
    "updated_at": "string" // 更新时间
  }
  ```

### 4.2 场景管理
- 场景数据以JSON格式存储，支持CRUD操作（创建、读取、更新、删除）。
- 每个场景包含以下信息：
  - 场景ID
  - 场景名称（如：问路、打车、点餐）
  - 场景描述
  - 创建时间
  - 更新时间
- 场景JSON Schema示例：
  ```json
  {
    "scene_id": "string", // 场景唯一ID
    "name": "string", // 场景名称
    "description": "string", // 场景描述
    "created_at": "string", // 创建时间
    "updated_at": "string" // 更新时间
  }
  ```

### 4.3 提示语工程
- 提供多种提示语模板，用于生成不同场景的故事。
- 提示语示例：
  - "请根据XX场景，设计一个小故事（或者对话），字数为150（正负30字），目的是让学习者掌握XXX级别的词汇（或XXX语法）。可选XXX词语为：（从JSON搜索出来的）"

### 4.4 故事生成
- 通过Deepseek API生成故事，故事内容需符合用户指定的词汇级别和场景。
- 支持设置故事的篇幅（字数）和篇幅容差（如±30字）。
- 生成的故事包含英文注释，以帮助用户理解。
- 故事生成API返回的JSON格式如下：
  ```json
  {
    "story_id": "string", // 故事唯一ID
    "title": "string", // 故事标题
    "content": "string", // 故事内容
    "vocabulary_level": "int", // 超童级别
    "scene": "string", // 场景标签（如：问路、打车、点餐）
    "word_count": "int", // 故事字数
    "new_words": [ // 生词列表
      {
        "word": "string", // 生词
        "pinyin": "string", // 拼音
        "definition": "string", // 释义
        "part_of_speech": "string", // 词性（枚举：名词、动词、形容词、副词等）
        "example": "string" // 例句
      }
    ],
    "created_at": "string" // 生成时间
  }
  ```

### 4.5 故事升级/降级
- 支持对现有故事进行升级或降级，根据目标级别替换或添加词汇。
- 升级/降级逻辑：
  - 从当前级别（如5级）升级到目标级别（如6级），替换或添加更高级别的词汇。
  - 从当前级别（如5级）降级到目标级别（如4级），替换或添加更低级别的词汇。
- 升级/降级API参数：
  - **story_id**：需要升级/降级的故事ID。
  - **target_level**：目标级别（超童级别）。
- 升级/降级API返回更新后的故事，格式与故事生成API一致。

### 4.6 API接口
- 提供API接口，用户可以通过以下参数生成故事：
  - **篇幅**：故事的字数范围。
  - **篇幅容差**：故事字数的正负容差范围（如±30字）。
  - **场景**：故事的场景标签（如：问路、打车、点餐）。
  - **目标词汇级别**：生词的超童级别。
  - **生词数量**：故事中包含的生词数量。
- 提供场景管理的API接口，支持场景的CRUD操作。
- 提供故事升级/降级的API接口，支持根据目标级别更新故事。
- API返回生成的故事、场景数据或更新后的故事，格式为JSON。

---

## 5. 非功能需求
### 5.1 性能
- 故事生成API的响应时间应控制在1秒以内。
- 场景管理API的响应时间应控制在500毫秒以内。
- 故事升级/降级API的响应时间应控制在1秒以内。

### 5.2 安全性
- API需进行身份验证，确保只有授权的语言学习机构可以调用。

### 5.3 可扩展性
- 词汇表和场景数据应支持动态更新，方便后续扩展。

---

## 6. 用户流程
1. **蓝色冰川**通过API调用，传入参数（篇幅、篇幅容差、场景、目标词汇级别、生词数量）。
2. 后端根据参数查询词汇表和场景数据，生成提示语。
3. 调用Deepseek API生成故事。
4. 返回生成的故事（JSON格式）给**蓝色冰川**。
5. **蓝色冰川**将故事提供给最终用户学习。
6. 用户或机构可以通过故事升级/降级API调整故事的词汇级别。

---

## 7. 优先级
### 高优先级
- 词汇分级与查询功能。
- 故事生成API的开发。
- 提示语工程的设计与实现。

### 中优先级
- 场景标签的设计与实现。
- 故事篇幅的设置功能。
- 故事升级/降级功能的开发。

### 低优先级
- 动态更新词汇表和场景数据的功能。

---

## 8. 时间线
- **第1周**：完成词汇表和场景数据的设计与JSON格式存储。
- **第2周**：开发词汇查询和场景管理功能。
- **第3周**：设计提示语模板，集成Deepseek API。
- **第4周**：开发故事生成API，支持场景标签和篇幅设置。
- **第5周**：开发故事升级/降级功能。
- **第6周**：测试与优化API性能。

---

## 9. 风险与假设
### 风险
- Deepseek API的生成效果可能不符合预期，需进行多次调优。
- 词汇表和场景数据的级别划分可能不够准确，需根据用户反馈调整。

### 假设
- **蓝色冰川**会提供足够的词汇数据和场景需求。
- Deepseek API的调用成本在可接受范围内。

---

## 10. 词汇表 JSON Schema 设计
```json
{
  "word_id": "string", // 词汇唯一ID
  "word": "string", // 词汇
  "pinyin": "string", // 拼音
  "definition": "string", // 释义
  "part_of_speech": "string", // 词性（枚举：名词、动词、形容词、副词等）
  "level": "int", // 超童级别
  "example": "string", // 例句
  "created_at": "string", // 创建时间
  "updated_at": "string" // 更新时间
}
```
